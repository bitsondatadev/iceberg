<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Iceberg Nessie Integration # Iceberg provides integration with Nessie through the iceberg-nessie module. This section describes how to use Iceberg with Nessie. Nessie provides several key features on top of Iceberg:
multi-table transactions git-like operations (eg branches, tags, commits) hive-like metastore capabilities See Project Nessie for more information on Nessie. Nessie requires a server to run, see Getting Started to start a Nessie server.
Enabling Nessie Catalog # The iceberg-nessie module is bundled with Spark and Flink runtimes for all versions from 0."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content="Nessie"><meta property="og:description" content="Iceberg Nessie Integration # Iceberg provides integration with Nessie through the iceberg-nessie module. This section describes how to use Iceberg with Nessie. Nessie provides several key features on top of Iceberg:
multi-table transactions git-like operations (eg branches, tags, commits) hive-like metastore capabilities See Project Nessie for more information on Nessie. Nessie requires a server to run, see Getting Started to start a Nessie server.
Enabling Nessie Catalog # The iceberg-nessie module is bundled with Spark and Flink runtimes for all versions from 0."><meta property="og:type" content="article"><meta property="og:url" content="https://iceberg.apache.org/docs/0.13.1/nessie/"><meta property="article:section" content="docs"><title>Nessie | Apache Iceberg</title><link rel=manifest href=/docs/0.13.1/manifest.json><link rel=icon href=/docs/0.13.1/favicon.png type=image/x-icon><link rel=stylesheet href=/docs/0.13.1/book.min.179e158d24f3ef709534173fd8b1c1e541a4fa3e23c1b5d8e887464c58949cc9.css integrity="sha256-F54VjSTz73CVNBc/2LHB5UGk+j4jwbXY6IdGTFiUnMk=" crossorigin=anonymous><script defer src=/docs/0.13.1/flexsearch.min.js></script>
<script defer src=/docs/0.13.1/en.search.min.4abf556e4fb8ef74f91e633ef8a4d5a2db1022e1867db9b260a3aa52a50e662c.js integrity="sha256-Sr9Vbk+473T5HmM++KTVotsQIuGGfbmyYKOqUqUOZiw=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/docs/0.13.1/../../><img src=/docs/0.13.1/img/iceberg-logo-icon.png alt=Logo><span>Apache Iceberg</span></a>
<a href=https://iceberg.apache.org/docs/0.13.1/../../releases><img id=version-shield src=https://img.shields.io/badge/version-0.13.1-blue alt></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul><a href=https://github.com/apache/iceberg target=_blank><img src=https://iceberg.apache.org/docs/0.13.1/img/GitHub-Mark.png target=_blank class=top-external-icon></a>
<a href=https://join.slack.com/t/apache-iceberg/shared_invite/zt-tlv0zjz6-jGJEkHfb1~heMCJA3Uycrg target=_blank><img src=https://iceberg.apache.org/docs/0.13.1/img/Slack_Mark_Web.png target=_blank class=top-external-icon></a></div><ul><li class=book-section-flats><span><i class="fa fa-table fa-fw"></i>
Tables</span><ul><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/0.13.1/configuration/>Configuration</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/0.13.1/evolution/>Evolution</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/0.13.1/maintenance/>Maintenance</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/0.13.1/partitioning/>Partitioning</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/0.13.1/performance/>Performance</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/0.13.1/reliability/>Reliability</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/0.13.1/schemas/>Schemas</a></li></ul></li><li class=book-section-flats><span><i class="fa fa-star-o fa-fw"></i>
Spark</span><ul><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/0.13.1/getting-started/>Getting Started</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/0.13.1/spark-configuration/>Configuration</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/0.13.1/spark-ddl/>DDL</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/0.13.1/spark-procedures/>Procedures</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/0.13.1/spark-queries/>Queries</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/0.13.1/spark-structured-streaming/>Structured Streaming</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/0.13.1/spark-writes/>Writes</a></li></ul></li><li class=book-section-flats><span><img src=https://iceberg.apache.org/docs/0.13.1/img/flink-logo.png class="navigation-icon fa-fw">Flink</span><ul><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/0.13.1/flink/>Getting Started</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/0.13.1/flink-connector/>Flink Connector</a></li></ul></li><li class=book-section-flats><a href=https://iceberg.apache.org/docs/0.13.1/hive/><img src=https://iceberg.apache.org/docs/0.13.1/img/../img/hive-logo.png class="navigation-icon fa-fw">Hive</a><ul></ul></li><li><a href=https://trino.io/docs/current/connector/iceberg.html target=_blank><img src=https://iceberg.apache.org/docs/0.13.1/img/../img/trino-logo.png class="navigation-icon fa-fw">
Trino</a></li><li><a href=https://prestodb.io/docs/current/connector/iceberg.html target=_blank><img src=https://iceberg.apache.org/docs/0.13.1/img/../img/prestodb-logo.png class="navigation-icon fa-fw">
Presto</a></li><li><a href=https://docs.dremio.com/data-formats/apache-iceberg/ target=_blank><img src=https://iceberg.apache.org/docs/0.13.1/img/../img/dremio-logo.png class="navigation-icon fa-fw">
Dremio</a></li><li><a href=https://docs.aws.amazon.com/athena/latest/ug/querying-iceberg.html target=_blank><img src=https://iceberg.apache.org/docs/0.13.1/img/../img/athena-logo.png class="navigation-icon fa-fw">
Amazon Athena</a></li><li><a href=https://docs.aws.amazon.com/emr/latest/ReleaseGuide/emr-iceberg-create-cluster.html target=_blank><img src=https://iceberg.apache.org/docs/0.13.1/img/../img/emr-logo.png class="navigation-icon fa-fw">
Amazon EMR</a></li><li class=book-section-collapsed><input type=checkbox id=section-56605d8e971a871885e28ee5142728bf class=toggle checked>
<label for=section-56605d8e971a871885e28ee5142728bf class="flex justify-between"><a role=button><i class="fa fa-handshake-o fa-fw"></i>
Integrations</a></label><ul><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/0.13.1/aws/>AWS</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/0.13.1/jdbc/>JDBC</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/0.13.1/nessie/ class=active>Nessie</a></li></ul></li><li class=book-section-collapsed><input type=checkbox id=section-bf7b3283e3790c00c8caaa140299052b class=toggle>
<label for=section-bf7b3283e3790c00c8caaa140299052b class="flex justify-between"><a role=button><i class="fa fa-connectdevelop fa-fw"></i>
API</a></label><ul><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/0.13.1/java-api-quickstart/>Java Quickstart</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/0.13.1/api/>Java API</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/0.13.1/custom-catalog/>Java Custom Catalog</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/0.13.1/../../javadoc/0.13.1>Javadocs</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/0.13.1/python-quickstart/>Python Quickstart</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/0.13.1/python-api-intro/>Python API</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/0.13.1/python-feature-support/>Python Feature Support</a></li></ul></li><li class=book-section-collapsed><input type=checkbox id=section-7e66f1754ca5d93e20ecdc89df5b8b28 class=toggle>
<label for=section-7e66f1754ca5d93e20ecdc89df5b8b28 class="flex justify-between"><a role=button><i class="fa fa-users fa-fw"></i>
Community</a></label><ul><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/0.13.1/../../../community>Join</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/0.13.1/../../../blogs>Blogs</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/0.13.1/../../../talks>Talks</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/0.13.1/../../../contribute>Contribute</a></li></ul></li><li class=book-section-collapsed><input type=checkbox id=section-87dda23e9104fe3231cee3bc88a2d754 class=toggle>
<label for=section-87dda23e9104fe3231cee3bc88a2d754 class="flex justify-between"><a role=button><i class="fa fa-object-ungroup fa-fw"></i>
Format</a></label><ul><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/0.13.1/../../../spec>Spec</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/0.13.1/../../../terms>Terms</a></li></ul></li><li class=book-section-collapsed><input type=checkbox id=section-2e5d3f5f142758d8dd368e9c281dd08e class=toggle>
<label for=section-2e5d3f5f142758d8dd368e9c281dd08e class="flex justify-between"><a role=button><i class="fa fa-wrench fa-fw"></i>
Project</a></label><ul><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/0.13.1/../../../how-to-release>How to Release</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/0.13.1/../../../multi-engine-support>Multi-Engine Support</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/0.13.1/../../../roadmap>Roadmap</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/0.13.1/../../../security>Security</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/0.13.1/../../../trademarks>Trademarks</a></li></ul></li><li class=book-section-collapsed><input type=checkbox id=section-4ddb27a8612bc8118c0b36386905d332 class=toggle>
<label for=section-4ddb27a8612bc8118c0b36386905d332 class="flex justify-between"><a role=button><i class="fa fa-code-fork fa-fw"></i>
Releases</a></label><ul><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/0.13.1/../latest>Latest</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/0.13.1/../0.13.1>0.13.1</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/0.13.1/../0.13.0>0.13.0</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/0.13.1/../0.12.1>0.12.1</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/0.13.1/../../../releases>Release Notes</a></li></ul></li><li class=book-section-collapsed><input type=checkbox id=section-296746d27808aa768e500824aaf2adea class=toggle>
<label for=section-296746d27808aa768e500824aaf2adea class="flex justify-between"><a role=button><img src=https://iceberg.apache.org/docs/0.13.1/img/../img/asf.png class="navigation-icon fa-fw">ASF</a></label><ul><li class=navigation-icon-pad><a href=https://www.apache.org/licenses/ target=_blank><i class="fa fa-external-link fa-fw"></i>
License</a></li><li class=navigation-icon-pad><a href=https://www.apache.org/security/ target=_blank><i class="fa fa-external-link fa-fw"></i>
Security</a></li><li class=navigation-icon-pad><a href=https://www.apache.org/foundation/thanks.html target=_blank><i class="fa fa-external-link fa-fw"></i>
Sponsors</a></li><li class=navigation-icon-pad><a href=https://www.apache.org/foundation/sponsorship.html target=_blank><i class="fa fa-external-link fa-fw"></i>
Donate</a></li><li class=navigation-icon-pad><a href=https://www.apache.org/events/current-event.html target=_blank><i class="fa fa-external-link fa-fw"></i>
Events</a></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><link rel=stylesheet href=/docs/0.13.1/fontawesome/css/font-awesome.min.css><label for=menu-control><img src=/docs/0.13.1/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Nessie</strong>
<label for=toc-control><img src=/docs/0.13.1/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#enabling-nessie-catalog>Enabling Nessie Catalog</a></li><li><a href=#spark-sql-extensions>Spark SQL Extensions</a></li><li><a href=#nessie-catalog>Nessie Catalog</a></li><li><a href=#nessie-and-iceberg>Nessie and Iceberg</a><ul><li><a href=#loosely-coupled-transactions>Loosely coupled transactions</a></li><li><a href=#experimentation>Experimentation</a></li><li><a href=#further-use-cases>Further use cases</a></li></ul></li><li><a href=#example>Example</a></li><li><a href=#future-improvements>Future Improvements</a></li></ul></nav></aside></header><article class=markdown><h1 id=iceberg-nessie-integration>Iceberg Nessie Integration
<a class=anchor href=#iceberg-nessie-integration>#</a></h1><p>Iceberg provides integration with Nessie through the <code>iceberg-nessie</code> module.
This section describes how to use Iceberg with Nessie. Nessie provides several key features on top of Iceberg:</p><ul><li>multi-table transactions</li><li>git-like operations (eg branches, tags, commits)</li><li>hive-like metastore capabilities</li></ul><p>See <a href=https://projectnessie.org>Project Nessie</a> for more information on Nessie. Nessie requires a server to run, see
<a href=https://projectnessie.org/try/>Getting Started</a> to start a Nessie server.</p><h2 id=enabling-nessie-catalog>Enabling Nessie Catalog
<a class=anchor href=#enabling-nessie-catalog>#</a></h2><p>The <code>iceberg-nessie</code> module is bundled with Spark and Flink runtimes for all versions from <code>0.11.0</code>. To get started
with Nessie and Iceberg simply add the Iceberg runtime to your process. Eg: <code>spark-sql --packages org.apache.iceberg:iceberg-spark3-runtime:0.13.1</code>.</p><h2 id=spark-sql-extensions>Spark SQL Extensions
<a class=anchor href=#spark-sql-extensions>#</a></h2><p>From Spark 3.0, Nessie SQL extensions can be used to manage the Nessie repo as shown below.</p><pre tabindex=0><code>bin/spark-sql 
  --packages &#34;org.apache.iceberg:iceberg-spark3-runtime:0.13.1,org.projectnessie:nessie-spark-extensions:0.18.0&#34;
  --conf spark.sql.extensions=&#34;org.apache.iceberg.spark.extensions.IcebergSparkSessionExtensions,org.projectnessie.spark.extensions.NessieSparkSessionExtensions&#34;
  --conf &lt;other settings&gt;
</code></pre><p>Please refer <a href=https://projectnessie.org/tools/sql/>Nessie SQL extension document</a> to learn more about it.</p><h2 id=nessie-catalog>Nessie Catalog
<a class=anchor href=#nessie-catalog>#</a></h2><p>One major feature introduced in release <code>0.11.0</code> is the ability to easily interact with a <a href=../custom-catalog>Custom
Catalog</a> from Spark and Flink. See <a href=../spark-configuration#catalog-configuration>Spark Configuration</a>
and <a href=../flink#custom-catalog>Flink Configuration</a> for instructions for adding a custom catalog to Iceberg.</p><p>To use the Nessie Catalog the following properties are required:</p><ul><li><code>warehouse</code>. Like most other catalogs the warehouse property is a file path to where this catalog should store tables.</li><li><code>uri</code>. This is the Nessie server base uri. Eg <code>http://localhost:19120/api/v1</code>.</li><li><code>ref</code> (optional). This is the Nessie branch or tag you want to work in.</li></ul><p>To run directly in Java this looks like:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>Map<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>,</span> String<span style=color:#f92672>&gt;</span> options <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> HashMap<span style=color:#f92672>&lt;&gt;();</span>
</span></span><span style=display:flex><span>options<span style=color:#f92672>.</span><span style=color:#a6e22e>put</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;warehouse&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;/path/to/warehouse&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>options<span style=color:#f92672>.</span><span style=color:#a6e22e>put</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;ref&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;main&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>options<span style=color:#f92672>.</span><span style=color:#a6e22e>put</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;uri&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;https://localhost:19120/api/v1&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>Catalog nessieCatalog <span style=color:#f92672>=</span> CatalogUtil<span style=color:#f92672>.</span><span style=color:#a6e22e>loadCatalog</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;org.apache.iceberg.nessie.NessieCatalog&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;nessie&#34;</span><span style=color:#f92672>,</span> hadoopConfig<span style=color:#f92672>,</span> options<span style=color:#f92672>);</span>
</span></span></code></pre></div><p>and in Spark:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>conf<span style=color:#f92672>.</span><span style=color:#a6e22e>set</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;spark.sql.catalog.nessie.warehouse&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;/path/to/warehouse&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>conf<span style=color:#f92672>.</span><span style=color:#a6e22e>set</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;spark.sql.catalog.nessie.uri&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;http://localhost:19120/api/v1&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>conf<span style=color:#f92672>.</span><span style=color:#a6e22e>set</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;spark.sql.catalog.nessie.ref&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;main&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>conf<span style=color:#f92672>.</span><span style=color:#a6e22e>set</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;spark.sql.catalog.nessie.catalog-impl&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;org.apache.iceberg.nessie.NessieCatalog&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>conf<span style=color:#f92672>.</span><span style=color:#a6e22e>set</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;spark.sql.catalog.nessie&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;org.apache.iceberg.spark.SparkCatalog&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>conf<span style=color:#f92672>.</span><span style=color:#a6e22e>set</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;spark.sql.extensions&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;org.apache.iceberg.spark.extensions.IcebergSparkSessionExtensions,org.projectnessie.spark.extensions.NessieSparkSessionExtensions&#34;</span><span style=color:#f92672>)</span>
</span></span></code></pre></div><p>This is how it looks in Flink via the Python API (additional details can be found <a href=../flink#preparation-when-using-flinks-python-api>here</a>):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> os
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> pyflink.datastream <span style=color:#f92672>import</span> StreamExecutionEnvironment
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> pyflink.table <span style=color:#f92672>import</span> StreamTableEnvironment
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>env <span style=color:#f92672>=</span> StreamExecutionEnvironment<span style=color:#f92672>.</span>get_execution_environment()
</span></span><span style=display:flex><span>iceberg_flink_runtime_jar <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>join(os<span style=color:#f92672>.</span>getcwd(), <span style=color:#e6db74>&#34;iceberg-flink-runtime-0.13.1.jar&#34;</span>)
</span></span><span style=display:flex><span>env<span style=color:#f92672>.</span>add_jars(<span style=color:#e6db74>&#34;file://</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>.</span>format(iceberg_flink_runtime_jar))
</span></span><span style=display:flex><span>table_env <span style=color:#f92672>=</span> StreamTableEnvironment<span style=color:#f92672>.</span>create(env)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>table_env<span style=color:#f92672>.</span>execute_sql(<span style=color:#e6db74>&#34;CREATE CATALOG nessie_catalog WITH (&#34;</span>
</span></span><span style=display:flex><span>                      <span style=color:#e6db74>&#34;&#39;type&#39;=&#39;iceberg&#39;, &#34;</span>
</span></span><span style=display:flex><span>                      <span style=color:#e6db74>&#34;&#39;catalog-impl&#39;=&#39;org.apache.iceberg.nessie.NessieCatalog&#39;, &#34;</span>
</span></span><span style=display:flex><span>                      <span style=color:#e6db74>&#34;&#39;uri&#39;=&#39;http://localhost:19120/api/v1&#39;, &#34;</span>
</span></span><span style=display:flex><span>                      <span style=color:#e6db74>&#34;&#39;ref&#39;=&#39;main&#39;, &#34;</span>
</span></span><span style=display:flex><span>                      <span style=color:#e6db74>&#34;&#39;warehouse&#39;=&#39;/path/to/warehouse&#39;)&#34;</span>)
</span></span></code></pre></div><p>There is nothing special above about the <code>nessie</code> name. A spark catalog can have any name, the important parts are the
settings for the <code>catalog-impl</code> and the required config to start Nessie correctly.
Once you have a Nessie catalog you have access to your entire Nessie repo. You can then perform create/delete/merge
operations on branches and perform commits on branches. Each Iceberg table in a Nessie Catalog is identified by an
arbitrary length namespace and table name (eg <code>data.base.name.table</code>). These namespaces are implicit and don&rsquo;t need to
be created separately. Any transaction on a Nessie enabled Iceberg table is a single commit in Nessie. Nessie commits
can encompass an arbitrary number of actions on an arbitrary number of tables, however in Iceberg this will be limited
to the set of single table transactions currently available.</p><p>Further operations such as merges, viewing the commit log or diffs are performed by direct interaction with the
<code>NessieClient</code> in java or by using the python client or cli. See <a href=https://projectnessie.org/tools/cli/>Nessie CLI</a> for
more details on the CLI and <a href=https://projectnessie.org/tools/iceberg/spark/>Spark Guide</a> for a more complete description of
Nessie functionality.</p><h2 id=nessie-and-iceberg>Nessie and Iceberg
<a class=anchor href=#nessie-and-iceberg>#</a></h2><p>For most cases Nessie acts just like any other Catalog for Iceberg: providing a logical organization of a set of tables
and providing atomicity to transactions. However, using Nessie opens up other interesting possibilities. When using Nessie with
Iceberg every Iceberg transaction becomes a Nessie commit. This history can be listed, merged or cherry-picked across branches.</p><h3 id=loosely-coupled-transactions>Loosely coupled transactions
<a class=anchor href=#loosely-coupled-transactions>#</a></h3><p>By creating a branch and performing a set of operations on that branch you can approximate a multi-table transaction.
A sequence of commits can be performed on the newly created branch and then merged back into the main branch atomically.
This gives the appearance of a series of connected changes being exposed to the main branch simultaneously. While downstream
consumers will see multiple transactions appear at once this isn&rsquo;t a true multi-table transaction on the database. It is
effectively a fast-forward merge of multiple commits (in git language) and each operation from the branch is its own distinct
transaction and commit. This is different from a real multi-table transaction where all changes would be in the same commit.
This does allow multiple applications to take part in modifying a branch and for this distributed set of transactions to be
exposed to the downstream users simultaneously.</p><h3 id=experimentation>Experimentation
<a class=anchor href=#experimentation>#</a></h3><p>Changes to a table can be tested in a branch before merging back into main. This is particularly useful when performing
large changes like schema evolution or partition evolution. A partition evolution could be performed in a branch and you
would be able to test out the change (eg performance benchmarks) before merging it. This provides great flexibility in
performing on-line table modifications and testing without interrupting downstream use cases. If the changes are
incorrect or not performant the branch can be dropped without being merged.</p><h3 id=further-use-cases>Further use cases
<a class=anchor href=#further-use-cases>#</a></h3><p>Please see the <a href=https://projectnessie.org/features/>Nessie Documentation</a> for further descriptions of
Nessie features.</p><blockquote class="book-hint danger">Regular table maintenance in Iceberg is complicated when using nessie. Please consult
<a href=https://projectnessie.org/features/management/>Management Services</a> before performing any
<a href=../maintenance>table maintenance</a>.</blockquote><h2 id=example>Example
<a class=anchor href=#example>#</a></h2><p>Please have a look at the <a href=https://github.com/projectnessie/nessie-demos>Nessie Demos repo</a>
for different examples of Nessie and Iceberg in action together.</p><h2 id=future-improvements>Future Improvements
<a class=anchor href=#future-improvements>#</a></h2><ul><li>Iceberg multi-table transactions. Changes to multiple Iceberg tables in the same transaction, isolation levels etc</li></ul></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(n){const e=window.getSelection(),t=document.createRange();t.selectNodeContents(n),e.removeAllRanges(),e.addRange(t)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#enabling-nessie-catalog>Enabling Nessie Catalog</a></li><li><a href=#spark-sql-extensions>Spark SQL Extensions</a></li><li><a href=#nessie-catalog>Nessie Catalog</a></li><li><a href=#nessie-and-iceberg>Nessie and Iceberg</a><ul><li><a href=#loosely-coupled-transactions>Loosely coupled transactions</a></li><li><a href=#experimentation>Experimentation</a></li><li><a href=#further-use-cases>Further use cases</a></li></ul></li><li><a href=#example>Example</a></li><li><a href=#future-improvements>Future Improvements</a></li></ul></nav></div></aside></main></body></html>